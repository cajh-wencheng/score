<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>段考成績查詢</title>
</head>

<body>
    <h1>段考成績查詢系統</h1>
    <label for="seatNumber">座號及姓名:</label>
    <select id="seatNumber"></select>
    <br>
    <label for="count">次數:</label>
    <select id="count"></select>
    <br>
    <label for="password">密碼:</label>
    <input type="password" id="password">
    <br>
    <button onclick="filterData()">查詢</button>
    <div id="result"></div>

    <script>
        const SHEET_ID = '1i3x67udPJRqjJZ6NLeRVXhjIJ0Vcv54CXWNQTezL6S0';  // ⚠️ 這裡填入你的 Google 試算表 ID
        const API_KEY = 'AIzaSyAI1Fr3Q_NthL7adXW9DUqO24pu7vQrpDc';  // ⚠️ 這裡填入你的 Google API 金鑰
        const SHEET_NAME = '工作表1';  // 例如 'Sheet1'

        async function fetchSheetData() {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
            const response = await fetch(url);
            const data = await response.json();
            return data.values || [];
        }

        async function loadDropdownOptions() {
            const data = await fetchSheetData();
            if (!data || data.length < 2) return;

            const seatNumbers = [...new Set(data.slice(1).map(row => row[0]))];
            const counts = [...new Set(data.slice(1).map(row => row[1]))];

            const seatNumberSelect = document.getElementById('seatNumber');
            const countSelect = document.getElementById('count');

            seatNumberSelect.innerHTML = '<option value="" disabled selected>請選擇座號</option>';
            countSelect.innerHTML = '<option value="" disabled selected>請選擇次數</option>';

            seatNumbers.forEach(seat => {
                const option = document.createElement('option');
                option.value = seat;
                option.textContent = seat;
                seatNumberSelect.appendChild(option);
            });

            counts.forEach(count => {
                const option = document.createElement('option');
                option.value = count;
                option.textContent = count;
                countSelect.appendChild(option);
            });
        }

        function convertGoogleDriveImageUrl(driveUrl) {
            if (driveUrl.includes("drive.google.com")) {
                const match = driveUrl.match(/\/d\/(.*)\/view/);
                return match ? `https://drive.google.com/uc?export=view&id=${match[1]}` : driveUrl;
            }
            return driveUrl;
        }

        window.onload = loadDropdownOptions;
    </script>
</body>
</html>
